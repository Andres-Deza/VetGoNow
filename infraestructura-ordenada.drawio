<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-09-05T12:00:00.000Z" agent="5.0" etag="new" version="24.0.0" type="device">
  <diagram id="VetGestion-Infrastructure-Ordenada" name="VetGestion Infrastructure">
    <mxGraphModel dx="1600" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- =================== TÃTULO PRINCIPAL =================== -->
        <mxCell id="title" value="VetGestion - Infraestructura ProducciÃ³n GCP" style="text;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=24;fontStyle=1;fontColor=#0D47A1;spacingTop=20;spacingBottom=20;" vertex="1" parent="1">
          <mxGeometry x="100" y="20" width="1400" height="70" as="geometry"/>
        </mxCell>

        <!-- =================== FILA 1: USUARIOS â†’ DNS â†’ FIREBASE =================== -->
        
        <!-- Usuarios Internet -->
        <mxCell id="users-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF5722;fillColor=#FFEBE9;" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-title" value="USUARIOS INTERNET" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="55" y="130" width="170" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-icon" value="ðŸ‘¥" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=40;" vertex="1" parent="1">
          <mxGeometry x="120" y="160" width="40" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-details" value="â€¢ Navegadores web&#10;â€¢ Aplicaciones mÃ³viles&#10;â€¢ Acceso HTTPS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="60" y="200" width="160" height="30" as="geometry"/>
        </mxCell>

        <!-- DNS + SSL -->
        <mxCell id="dns-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="240" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="dns-title" value="DNS + SSL + CERTIFICATE MANAGER" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="305" y="130" width="230" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="dns-left" value="ðŸŒ CLOUD DNS&#10;&#10;â€¢ vetgestion.cl&#10;â€¢ ResoluciÃ³n rÃ¡pida&#10;â€¢ GestiÃ³n automÃ¡tica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="310" y="160" width="110" height="70" as="geometry"/>
        </mxCell>
        
        <mxCell id="ssl-right" value="ðŸ”’ SSL GESTIONADO&#10;&#10;â€¢ Certificate Manager&#10;â€¢ Auto-renovaciÃ³n&#10;â€¢ TLS 1.3&#10;â€¢ Certificados Google" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="425" y="160" width="110" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Hosting -->
        <mxCell id="firebase-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2196F3;fillColor=#E3F2FD;" vertex="1" parent="1">
          <mxGeometry x="610" y="120" width="240" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-title" value="FIREBASE HOSTING" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="615" y="130" width="230" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-subtitle" value="Frontend + CDN Global" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontColor=#1976D2;" vertex="1" parent="1">
          <mxGeometry x="615" y="150" width="230" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-details" value="ðŸ”¥ React SPA&#10;ðŸŒ CDN Global&#10;âš¡ Deploy automÃ¡tico&#10;ðŸ“± PWA Ready" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="620" y="175" width="220" height="55" as="geometry"/>
        </mxCell>

        <!-- =================== FILA 2: CLOUD RUN + CONECTIVIDAD =================== -->
        
        <mxCell id="cloudrun-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#E8F5E8;" vertex="1" parent="1">
          <mxGeometry x="50" y="320" width="760" height="160" as="geometry"/>
        </mxCell>
        
        <mxCell id="cloudrun-main-title" value="CLOUD RUN + CONECTIVIDAD" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=16;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="55" y="330" width="750" height="25" as="geometry"/>
        </mxCell>

        <!-- Cloud Run Backend -->
        <mxCell id="cloudrun-backend" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#C8E6C9;" vertex="1" parent="1">
          <mxGeometry x="70" y="360" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="backend-title" value="â˜ï¸ CLOUD RUN BACKEND" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="75" y="365" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="backend-details" value="Node.js + Express&#10;southamerica-west1&#10;â€¢ Auto-scaling&#10;â€¢ Container privado&#10;â€¢ 0 â†’ N instancias" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="80" y="385" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- VPC Connector -->
        <mxCell id="vpc-connector" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;" vertex="1" parent="1">
          <mxGeometry x="300" y="360" width="180" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="vpc-title" value="ðŸ”— SERVERLESS VPC CONNECTOR" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="305" y="365" width="170" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="vpc-details" value="Conectividad privada&#10;southamerica-west1&#10;â€¢ Acceso VPC recursos&#10;â€¢ Throughput: 300Mbps&#10;â€¢ Instancias mÃ­nimas: 2" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="310" y="385" width="160" height="70" as="geometry"/>
        </mxCell>

        <!-- Cloud NAT -->
        <mxCell id="cloud-nat" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#3F51B5;fillColor=#E8EAF6;" vertex="1" parent="1">
          <mxGeometry x="510" y="360" width="180" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="nat-title" value="ðŸ“¡ CLOUD NAT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#283593;" vertex="1" parent="1">
          <mxGeometry x="515" y="365" width="170" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="nat-details" value="NAT para egreso&#10;southamerica-west1&#10;â€¢ IPs estÃ¡ticas&#10;â€¢ Salida a internet&#10;â€¢ APIs externas" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#283593;" vertex="1" parent="1">
          <mxGeometry x="520" y="385" width="160" height="70" as="geometry"/>
        </mxCell>

        <!-- Load Balancer -->
        <mxCell id="load-balancer" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF3E0;" vertex="1" parent="1">
          <mxGeometry x="720" y="360" width="180" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="lb-title" value="âš–ï¸ LOAD BALANCER" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="725" y="365" width="170" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="lb-details" value="HTTP(S) Global&#10;â€¢ SSL Termination&#10;â€¢ CDN integrado&#10;â€¢ Auto-scaling&#10;â€¢ Health checks" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="730" y="385" width="160" height="70" as="geometry"/>
        </mxCell>

        <!-- =================== SERVICIOS DE DATOS =================== -->
        
        <mxCell id="database-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#E8F5E8;" vertex="1" parent="1">
          <mxGeometry x="940" y="120" width="480" height="360" as="geometry"/>
        </mxCell>
        
        <mxCell id="database-title" value="SERVICIOS DE DATOS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=16;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="945" y="130" width="470" height="25" as="geometry"/>
        </mxCell>

        <!-- MongoDB Atlas -->
        <mxCell id="mongodb-atlas" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#C8E6C9;" vertex="1" parent="1">
          <mxGeometry x="960" y="160" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="mongo-title" value="ðŸƒ MONGODB ATLAS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="965" y="165" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="mongo-details" value="M10+ Production&#10;southamerica-west1&#10;â€¢ VPC Peering (privado)&#10;â€¢ NO usa NAT&#10;â€¢ Backups + PITR&#10;â€¢ RÃ©plicas multi-AZ" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="970" y="185" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Redis Cache -->
        <mxCell id="redis-cache" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#E91E63;fillColor=#FCE4EC;" vertex="1" parent="1">
          <mxGeometry x="1200" y="160" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="redis-title" value="âš¡ MEMORYSTORE REDIS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#AD1457;" vertex="1" parent="1">
          <mxGeometry x="1205" y="165" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="redis-details" value="Cache en memoria&#10;southamerica-west1&#10;â€¢ Acceso vÃ­a VPC&#10;â€¢ Rate limiting&#10;â€¢ Socket.IO adapter&#10;â€¢ Sesiones usuario" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#AD1457;" vertex="1" parent="1">
          <mxGeometry x="1210" y="185" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Storage -->
        <mxCell id="firebase-storage" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF5722;fillColor=#FFEBE9;" vertex="1" parent="1">
          <mxGeometry x="960" y="280" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="storage-title" value="ðŸ“ FIREBASE STORAGE" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="965" y="285" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="storage-details" value="Bucket privado&#10;Global CDN&#10;â€¢ Signed URLs&#10;â€¢ Archivos mÃ©dicos&#10;â€¢ No servir directo&#10;â€¢ ExpiraciÃ³n automÃ¡tica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="970" y="305" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Auth -->
        <mxCell id="firebase-auth" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;" vertex="1" parent="1">
          <mxGeometry x="1200" y="280" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="auth-title" value="ðŸ” FIREBASE AUTH" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="1205" y="285" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="auth-details" value="AutenticaciÃ³n OAuth&#10;JWT automÃ¡tico&#10;â€¢ Google Sign-in&#10;â€¢ GestiÃ³n usuarios&#10;â€¢ Roles y permisos&#10;â€¢ Tokens seguros" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="1210" y="305" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- =================== SERVICIOS ADMINISTRATIVOS =================== -->
        
        <mxCell id="admin-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="1370" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="admin-title" value="SERVICIOS ADMINISTRATIVOS Y SEGURIDAD" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=16;fontStyle=1;fontColor=#37474F;" vertex="1" parent="1">
          <mxGeometry x="55" y="530" width="1360" height="25" as="geometry"/>
        </mxCell>

        <!-- Secret Manager -->
        <mxCell id="secret-manager" value="ðŸ”‘ SECRET MANAGER&#10;&#10;Claves y secretos&#10;encriptados" style="text;html=1;strokeColor=#795548;fillColor=#EFEBE9;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#5D4037;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Cloud Operations -->
        <mxCell id="observability" value="ðŸ“Š CLOUD OPERATIONS&#10;&#10;Logging + Monitoring + APM&#10;Traces + Performance" style="text;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#37474F;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- CI/CD -->
        <mxCell id="cicd" value="ðŸš€ CI/CD PIPELINE&#10;&#10;Cloud Build + Deploy&#10;AutomatizaciÃ³n" style="text;html=1;strokeColor=#FF9800;fillColor=#FFF3E0;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#E65100;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- External Services -->
        <mxCell id="external-services" value="ðŸŒ SERVICIOS EXTERNOS&#10;&#10;APIs externas&#10;Integraciones" style="text;html=1;strokeColor=#F44336;fillColor=#FFEBEE;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#C62828;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- IAM Security -->
        <mxCell id="iam-security" value="ðŸ›¡ï¸ IAM + SECURITY&#10;&#10;Control de acceso&#10;PolÃ­ticas de seguridad" style="text;html=1;strokeColor=#795548;fillColor=#EFEBE9;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#5D4037;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="880" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Network Security -->
        <mxCell id="network-security" value="ðŸ” NETWORK SECURITY&#10;&#10;Firewall Rules + VPC&#10;Security Policies" style="text;html=1;strokeColor=#795548;fillColor=#EFEBE9;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#5D4037;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1080" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Backup Services -->
        <mxCell id="backup-services" value="ðŸ’¾ BACKUP SERVICES&#10;&#10;Respaldos automÃ¡ticos&#10;DR Strategy" style="text;html=1;strokeColor=#4CAF50;fillColor=#E8F5E8;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#2E7D32;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1280" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- =================== CONEXIONES PRINCIPALES =================== -->
        
        <!-- Usuario -> DNS -->
        <mxCell id="flow-user-dns" value="" style="endArrow=classic;html=1;strokeColor=#1976D2;strokeWidth=4;curved=0;" edge="1" parent="1" source="users-container" target="dns-container">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="180" as="sourcePoint"/>
            <mxPoint x="300" y="180" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- DNS -> Firebase -->
        <mxCell id="flow-dns-firebase" value="" style="endArrow=classic;html=1;strokeColor=#2196F3;strokeWidth=4;curved=0;" edge="1" parent="1" source="dns-container" target="firebase-container">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="180" as="sourcePoint"/>
            <mxPoint x="610" y="180" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Firebase -> Cloud Run -->
        <mxCell id="flow-firebase-cloudrun" value="" style="endArrow=classic;html=1;strokeColor=#4CAF50;strokeWidth=4;curved=0;" edge="1" parent="1" source="firebase-container" target="cloudrun-backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="730" y="240" as="sourcePoint"/>
            <mxPoint x="170" y="360" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="730" y="290"/>
              <mxPoint x="170" y="290"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> VPC -->
        <mxCell id="flow-cloudrun-vpc" value="" style="endArrow=classic;html=1;strokeColor=#9C27B0;strokeWidth=3;curved=0;" edge="1" parent="1" source="cloudrun-backend" target="vpc-connector">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="410" as="sourcePoint"/>
            <mxPoint x="300" y="410" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- VPC -> MongoDB -->
        <mxCell id="flow-vpc-mongo" value="" style="endArrow=classic;html=1;strokeColor=#4CAF50;strokeWidth=4;curved=0;" edge="1" parent="1" source="vpc-connector" target="mongodb-atlas">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="480" y="410" as="sourcePoint"/>
            <mxPoint x="960" y="210" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="630" y="290"/>
              <mxPoint x="1060" y="290"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Redis -->
        <mxCell id="flow-cloudrun-redis" value="" style="endArrow=classic;html=1;strokeColor=#E91E63;strokeWidth=3;curved=0;" edge="1" parent="1" source="cloudrun-backend" target="redis-cache">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="360" as="sourcePoint"/>
            <mxPoint x="1200" y="210" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="170" y="300"/>
              <mxPoint x="1300" y="300"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Firebase Storage -->
        <mxCell id="flow-cloudrun-storage" value="" style="endArrow=classic;html=1;strokeColor=#FF5722;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="firebase-storage">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="410" as="sourcePoint"/>
            <mxPoint x="960" y="330" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="450" y="460"/>
              <mxPoint x="1060" y="460"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Firebase Auth -->
        <mxCell id="flow-cloudrun-auth" value="" style="endArrow=classic;html=1;strokeColor=#9C27B0;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="firebase-auth">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="410" as="sourcePoint"/>
            <mxPoint x="1200" y="330" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="500" y="490"/>
              <mxPoint x="1300" y="490"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- VPC -> NAT -->
        <mxCell id="flow-vpc-nat" value="" style="endArrow=classic;html=1;strokeColor=#3F51B5;strokeWidth=3;curved=0;" edge="1" parent="1" source="vpc-connector" target="cloud-nat">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="480" y="410" as="sourcePoint"/>
            <mxPoint x="510" y="410" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- NAT -> External Services -->
        <mxCell id="flow-nat-external" value="" style="endArrow=classic;html=1;strokeColor=#F44336;strokeWidth=2;curved=0;" edge="1" parent="1" source="cloud-nat" target="external-services">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="460" as="sourcePoint"/>
            <mxPoint x="760" y="560" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="600" y="500"/>
              <mxPoint x="760" y="500"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Firebase -> Load Balancer -->
        <mxCell id="flow-firebase-lb" value="" style="endArrow=classic;html=1;strokeColor=#FF9800;strokeWidth=3;curved=0;" edge="1" parent="1" source="firebase-container" target="load-balancer">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="730" y="240" as="sourcePoint"/>
            <mxPoint x="810" y="360" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="810" y="290"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run conexiones administrativas -->
        <mxCell id="flow-cloudrun-secret" value="" style="endArrow=classic;html=1;strokeColor=#795548;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="secret-manager">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="460" as="sourcePoint"/>
            <mxPoint x="160" y="560" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-cloudrun-obs" value="" style="endArrow=classic;html=1;strokeColor=#607D8B;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="observability">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="460" as="sourcePoint"/>
            <mxPoint x="360" y="560" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="240" y="510"/>
              <mxPoint x="360" y="510"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-cicd-cloudrun" value="" style="endArrow=classic;html=1;strokeColor=#FF9800;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cicd" target="cloudrun-backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="560" as="sourcePoint"/>
            <mxPoint x="170" y="460" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="560" y="520"/>
              <mxPoint x="300" y="520"/>
              <mxPoint x="170" y="520"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Labels para conexiones -->
        <mxCell id="label-https" value="HTTPS" style="text;html=1;strokeColor=#FFFFFF;fillColor=#1976D2;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="250" y="170" width="50" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-ssl" value="SSL/CDN" style="text;html=1;strokeColor=#FFFFFF;fillColor=#2196F3;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="170" width="60" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-api" value="API Calls" style="text;html=1;strokeColor=#FFFFFF;fillColor=#4CAF50;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="280" width="70" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-vpc" value="VPC" style="text;html=1;strokeColor=#FFFFFF;fillColor=#9C27B0;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="400" width="40" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-db" value="Private DB" style="text;html=1;strokeColor=#FFFFFF;fillColor=#4CAF50;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="280" width="70" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-cache" value="Cache" style="text;html=1;strokeColor=#FFFFFF;fillColor=#E91E63;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="750" y="290" width="50" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-nat" value="NAT" style="text;html=1;strokeColor=#FFFFFF;fillColor=#3F51B5;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="400" width="40" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-external" value="External APIs" style="text;html=1;strokeColor=#FFFFFF;fillColor=#F44336;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="630" y="490" width="80" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
  <diagram id="VetGestion-Infrastructure-Ordenada" name="VetGestion Infrastructure Ordenada">
    <mxGraphModel dx="1600" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- =================== TÃTULO PRINCIPAL =================== -->
        <mxCell id="title" value="VetGestion - Infraestructura ProducciÃ³n GCP" style="text;html=1;strokeColor=#1976D2;fillColor=#E3F2FD;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=24;fontStyle=1;fontColor=#0D47A1;spacingTop=20;spacingBottom=20;" vertex="1" parent="1">
          <mxGeometry x="100" y="20" width="1400" height="70" as="geometry"/>
        </mxCell>

        <!-- =================== FILA 1: USUARIOS â†’ DNS â†’ FIREBASE (mÃ¡s separados) =================== -->
        
        <!-- Usuarios Internet -->
        <mxCell id="users-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF5722;fillColor=#FFEBE9;" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="180" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-title" value="USUARIOS INTERNET" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="55" y="130" width="170" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-icon" value="ðŸ‘¥" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=40;" vertex="1" parent="1">
          <mxGeometry x="120" y="160" width="40" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="users-details" value="â€¢ Navegadores web&#10;â€¢ Aplicaciones mÃ³viles&#10;â€¢ Acceso HTTPS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="60" y="200" width="160" height="30" as="geometry"/>
        </mxCell>

        <!-- DNS + SSL -->
        <mxCell id="dns-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;" vertex="1" parent="1">
          <mxGeometry x="300" y="120" width="240" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="dns-title" value="DNS + SSL GESTIONADO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="305" y="130" width="230" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="dns-left" value="ðŸŒ CLOUD DNS&#10;&#10;â€¢ vetgestion.cl&#10;â€¢ ResoluciÃ³n rÃ¡pida&#10;â€¢ GestiÃ³n automÃ¡tica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="310" y="160" width="110" height="70" as="geometry"/>
        </mxCell>
        
        <mxCell id="ssl-right" value="ðŸ”’ SSL GESTIONADO&#10;&#10;â€¢ Certificate Manager (Google)&#10;â€¢ Auto-renovaciÃ³n&#10;â€¢ TLS 1.3" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="425" y="160" width="110" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Hosting -->
        <mxCell id="firebase-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2196F3;fillColor=#E3F2FD;" vertex="1" parent="1">
          <mxGeometry x="610" y="120" width="240" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-title" value="FIREBASE HOSTING" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="615" y="130" width="230" height="25" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-subtitle" value="Frontend + CDN Global" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontColor=#1976D2;" vertex="1" parent="1">
          <mxGeometry x="615" y="150" width="230" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="firebase-details" value="ðŸ”¥ React SPA&#10;ðŸŒ CDN Global&#10;âš¡ Deploy automÃ¡tico&#10;ðŸ“± PWA Ready" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="620" y="175" width="220" height="55" as="geometry"/>
        </mxCell>

        <!-- =================== FILA 2: CLOUD RUN + CONECTIVIDAD (mÃ¡s separado verticalmente) =================== -->
        
        <mxCell id="cloudrun-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#E8F5E8;" vertex="1" parent="1">
          <mxGeometry x="50" y="320" width="760" height="160" as="geometry"/>
        </mxCell>
        
        <mxCell id="cloudrun-main-title" value="CLOUD RUN + CONECTIVIDAD" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=16;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="55" y="330" width="750" height="25" as="geometry"/>
        </mxCell>

        <!-- Cloud Run Backend -->
        <mxCell id="cloudrun-backend" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2196F3;fillColor=#E3F2FD;" vertex="1" parent="1">
          <mxGeometry x="70" y="320" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="cloudrun-title" value="â˜ï¸ CLOUD RUN" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="75" y="325" width="150" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="cloudrun-details" value="Express.js API&#10;southamerica-west1&#10;â€¢ minInstances=0-1&#10;â€¢ CPU on-request&#10;â€¢ Concurrency baja (WebSockets)&#10;â€¢ Auto-escalamiento" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="80" y="345" width="140" height="70" as="geometry"/>
        </mxCell>

        <!-- VPC Connector -->
        <mxCell id="vpc-connector" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;" vertex="1" parent="1">
          <mxGeometry x="250" y="320" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="vpc-title" value="ðŸ”— SERVERLESS VPC CONNECTOR" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="255" y="325" width="150" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="vpc-details" value="Serverless VPC Access&#10;southamerica-west1&#10;â€¢ Conectividad privada&#10;â€¢ Misma regiÃ³n&#10;â€¢ Baja latencia" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="260" y="345" width="140" height="70" as="geometry"/>
        </mxCell>

        <!-- Cloud NAT -->
        <mxCell id="cloud-nat" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF3E0;" vertex="1" parent="1">
          <mxGeometry x="430" y="320" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="nat-title" value="ðŸŒ CLOUD NAT" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#F57C00;" vertex="1" parent="1">
          <mxGeometry x="435" y="325" width="150" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="nat-details" value="Solo egreso a Internet&#10;(APIs externas)&#10;â€¢ OpenAI/SMTP/Webpay&#10;â€¢ IP fija allowlist&#10;â€¢ NO ingreso directo" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#F57C00;" vertex="1" parent="1">
          <mxGeometry x="440" y="345" width="140" height="70" as="geometry"/>
        </mxCell>

        <!-- Load Balancer (OPCIONAL) -->
        <mxCell id="load-balancer" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="610" y="320" width="160" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="lb-title" value="âš–ï¸ LOAD BALANCER" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="615" y="325" width="150" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="lb-subtitle" value="(OPCIONAL)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FF5722;" vertex="1" parent="1">
          <mxGeometry x="615" y="340" width="150" height="15" as="geometry"/>
        </mxCell>
        
        <mxCell id="lb-details" value="â€¢ Cloud Armor/WAF&#10;â€¢ Rutas avanzadas&#10;â€¢ Unificar dominios&#10;Cloud Run ya expone HTTPS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=9;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="620" y="355" width="140" height="55" as="geometry"/>
        </mxCell>


        <!-- MongoDB Atlas (reposicionado para nuevo contenedor) -->
        <mxCell id="mongodb-atlas" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#4CAF50;fillColor=#C8E6C9;" vertex="1" parent="1">
          <mxGeometry x="960" y="160" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="mongo-title" value="ðŸƒ MONGODB ATLAS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="965" y="165" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="mongo-details" value="M10+ Production&#10;southamerica-west1&#10;â€¢ VPC Peering o PSC (privado)&#10;â€¢ NO usa NAT (directo)&#10;â€¢ Backups + PITR&#10;â€¢ RÃ©plicas multi-AZ" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="970" y="185" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Redis Cache (reposicionado para nuevo contenedor) -->
        <mxCell id="redis-cache" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#E91E63;fillColor=#FCE4EC;" vertex="1" parent="1">
          <mxGeometry x="1200" y="160" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="redis-title" value="âš¡ MEMORYSTORE REDIS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#AD1457;" vertex="1" parent="1">
          <mxGeometry x="1205" y="165" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="redis-details" value="Cache en memoria&#10;southamerica-west1&#10;â€¢ Misma regiÃ³n&#10;â€¢ Acceso vÃ­a VPC Connector&#10;â€¢ Rate limiting&#10;â€¢ Socket.IO adapter" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#AD1457;" vertex="1" parent="1">
          <mxGeometry x="1210" y="185" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Storage (reposicionado para nuevo contenedor) -->
        <mxCell id="firebase-storage" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF5722;fillColor=#FFEBE9;" vertex="1" parent="1">
          <mxGeometry x="960" y="280" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="storage-title" value="ðŸ“ FIREBASE STORAGE" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="965" y="285" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="storage-details" value="Bucket privado&#10;Global CDN&#10;â€¢ Signed URLs (lectura/escritura)&#10;â€¢ Archivos mÃ©dicos&#10;â€¢ No servir directo&#10;â€¢ ExpiraciÃ³n automÃ¡tica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#D84315;" vertex="1" parent="1">
          <mxGeometry x="970" y="305" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- Firebase Auth (reposicionado para nuevo contenedor) -->
        <mxCell id="firebase-auth" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;" vertex="1" parent="1">
          <mxGeometry x="1200" y="280" width="200" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="auth-title" value="ðŸ” FIREBASE AUTH" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="1205" y="285" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="auth-details" value="AutenticaciÃ³n OAuth&#10;JWT automÃ¡tico&#10;â€¢ Google Sign-in&#10;â€¢ GestiÃ³n usuarios&#10;â€¢ Roles y permisos" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=10;fontColor=#7B1FA2;" vertex="1" parent="1">
          <mxGeometry x="1210" y="305" width="180" height="70" as="geometry"/>
        </mxCell>

        <!-- =================== FILA 3: SERVICIOS ADMINISTRATIVOS (nueva secciÃ³n inferior) =================== -->
        
        <mxCell id="admin-container" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="1350" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="admin-title" value="SERVICIOS ADMINISTRATIVOS Y OBSERVABILIDAD" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=16;fontStyle=1;fontColor=#37474F;" vertex="1" parent="1">
          <mxGeometry x="55" y="530" width="1340" height="25" as="geometry"/>
        </mxCell>

        <!-- Secret Manager -->
        <mxCell id="secret-manager" value="ðŸ”‘ SECRET MANAGER&#10;&#10;Claves y secretos&#10;encriptados" style="text;html=1;strokeColor=#795548;fillColor=#EFEBE9;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#5D4037;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Observability -->
        <mxCell id="observability" value="ðŸ“Š OBSERVABILIDAD&#10;&#10;Logging + Monitoring&#10;Cloud Operations" style="text;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#37474F;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- CI/CD -->
        <mxCell id="cicd" value="ðŸš€ CI/CD PIPELINE&#10;&#10;Cloud Build + Deploy&#10;AutomatizaciÃ³n" style="text;html=1;strokeColor=#FF9800;fillColor=#FFF3E0;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#E65100;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- External Services -->
        <mxCell id="external-services" value="ðŸŒ SERVICIOS EXTERNOS&#10;&#10;APIs externas&#10;Integraciones" style="text;html=1;strokeColor=#F44336;fillColor=#FFEBEE;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#C62828;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- VPC Connector -->
        <mxCell id="vpc-connector" value="ðŸ”— VPC CONNECTOR&#10;&#10;Conectividad privada&#10;southamerica-west1" style="text;html=1;strokeColor=#9C27B0;fillColor=#F3E5F5;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#7B1FA2;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="880" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Cloud NAT -->
        <mxCell id="cloud-nat" value="ðŸ“¡ CLOUD NAT&#10;&#10;Egreso administrado&#10;IPs estÃ¡ticas" style="text;html=1;strokeColor=#3F51B5;fillColor=#E8EAF6;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#283593;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1080" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Load Balancer -->
        <mxCell id="load-balancer" value="âš–ï¸ LOAD BALANCER&#10;&#10;DistribuciÃ³n de carga&#10;Global" style="text;html=1;strokeColor=#4CAF50;fillColor=#E8F5E8;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontColor=#2E7D32;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1280" y="560" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- =================== CONEXIONES PRINCIPALES =================== -->
        
        <!-- Usuario -> DNS (horizontal directa) -->
        <mxCell id="flow-user-dns" value="" style="endArrow=classic;html=1;strokeColor=#1976D2;strokeWidth=4;curved=0;" edge="1" parent="1" source="users-container" target="dns-container">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="180" as="sourcePoint"/>
            <mxPoint x="280" y="180" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- DNS -> Firebase (horizontal directa) -->
        <mxCell id="flow-dns-firebase" value="" style="endArrow=classic;html=1;strokeColor=#2196F3;strokeWidth=4;curved=0;" edge="1" parent="1" source="dns-container" target="firebase-container">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="180" as="sourcePoint"/>
            <mxPoint x="570" y="180" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Firebase -> Cloud Run (vertical limpia) -->
        <mxCell id="flow-firebase-cloudrun" value="" style="endArrow=classic;html=1;strokeColor=#4CAF50;strokeWidth=5;curved=0;" edge="1" parent="1" source="firebase-container" target="cloudrun-backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="690" y="240" as="sourcePoint"/>
            <mxPoint x="150" y="320" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="690" y="280"/>
              <mxPoint x="150" y="280"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> VPC (horizontal directa) -->
        <mxCell id="flow-cloudrun-vpc" value="" style="endArrow=classic;html=1;strokeColor=#9C27B0;strokeWidth=3;curved=0;" edge="1" parent="1" source="cloudrun-backend" target="vpc-connector">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="370" as="sourcePoint"/>
            <mxPoint x="250" y="370" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- VPC -> MongoDB (ruta optimizada sin pasar por componentes) -->
        <mxCell id="flow-vpc-mongo" value="" style="endArrow=classic;html=1;strokeColor=#4CAF50;strokeWidth=4;curved=0;" edge="1" parent="1" source="vpc-connector" target="mongodb-atlas">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="330" as="sourcePoint"/>
            <mxPoint x="880" y="210" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="330" y="300"/>
              <mxPoint x="330" y="90"/>
              <mxPoint x="980" y="90"/>
              <mxPoint x="980" y="160"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Redis (para rate-limit, cache, Socket.IO) -->
        <mxCell id="flow-cloudrun-redis" value="" style="endArrow=classic;html=1;strokeColor=#E91E63;strokeWidth=3;curved=0;" edge="1" parent="1" source="cloudrun-backend" target="redis-cache">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="320" as="sourcePoint"/>
            <mxPoint x="1120" y="210" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="30" y="370"/>
              <mxPoint x="30" y="100"/>
              <mxPoint x="1220" y="100"/>
              <mxPoint x="1220" y="210"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Firebase Storage (ruta optimizada) -->
        <mxCell id="flow-cloudrun-storage" value="" style="endArrow=classic;html=1;strokeColor=#FF5722;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="firebase-storage">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="380" as="sourcePoint"/>
            <mxPoint x="880" y="330" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="150" y="440"/>
              <mxPoint x="850" y="440"/>
              <mxPoint x="850" y="330"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cloud Run -> Firebase Auth (ruta optimizada) -->
        <mxCell id="flow-cloudrun-auth" value="" style="endArrow=classic;html=1;strokeColor=#9C27B0;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="firebase-auth">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="380" as="sourcePoint"/>
            <mxPoint x="1120" y="330" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="150" y="450"/>
              <mxPoint x="1220" y="450"/>
              <mxPoint x="1220" y="330"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Labels para conexiones (reposicionadas) -->
        <mxCell id="label-https" value="HTTPS" style="text;html=1;strokeColor=#FFFFFF;fillColor=#1976D2;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="170" width="50" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-ssl" value="SSL/CDN" style="text;html=1;strokeColor=#FFFFFF;fillColor=#2196F3;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="170" width="60" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-api" value="API Calls" style="text;html=1;strokeColor=#FFFFFF;fillColor=#4CAF50;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="270" width="70" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-vpc" value="VPC" style="text;html=1;strokeColor=#FFFFFF;fillColor=#9C27B0;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="350" width="40" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-db" value="Private DB" style="text;html=1;strokeColor=#FFFFFF;fillColor=#4CAF50;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="80" width="70" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-cache" value="Rate-limit/Cache" style="text;html=1;strokeColor=#FFFFFF;fillColor=#E91E63;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=9;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="90" width="90" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-storage" value="Files" style="text;html=1;strokeColor=#FFFFFF;fillColor=#FF5722;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="440" width="40" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="label-auth" value="Auth" style="text;html=1;strokeColor=#FFFFFF;fillColor=#9C27B0;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=10;fontStyle=1;fontColor=#FFFFFF;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="450" width="40" height="20" as="geometry"/>
        </mxCell>

        <!-- =================== SERVICIOS ADICIONALES =================== -->
        
        <!-- Secret Manager + IAM -->
        <mxCell id="secret-manager" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#795548;fillColor=#EFEBE9;" vertex="1" parent="1">
          <mxGeometry x="50" y="500" width="180" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="secret-title" value="ðŸ” SECRET MANAGER + IAM" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="55" y="505" width="170" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="secret-details" value="â€¢ Claves API/DB seguras&#10;â€¢ Roles IAM especÃ­ficos&#10;â€¢ Service accounts" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=9;fontColor=#5D4037;" vertex="1" parent="1">
          <mxGeometry x="60" y="525" width="160" height="50" as="geometry"/>
        </mxCell>

        <!-- Observabilidad -->
        <mxCell id="observability" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#607D8B;fillColor=#ECEFF1;" vertex="1" parent="1">
          <mxGeometry x="250" y="500" width="220" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="observability-title" value="ðŸ“Š LOGGING/MONITORING/ALERTING" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#455A64;" vertex="1" parent="1">
          <mxGeometry x="255" y="505" width="210" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="observability-details" value="â€¢ Cloud Logging centralizado&#10;â€¢ Cloud Monitoring + mÃ©tricas&#10;â€¢ Alertas automÃ¡ticas&#10;â€¢ Alertas de Billing/Budgets&#10;â€¢ Traces distribuidos" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=9;fontColor=#455A64;" vertex="1" parent="1">
          <mxGeometry x="260" y="525" width="200" height="50" as="geometry"/>
        </mxCell>

        <!-- CI/CD -->
        <mxCell id="cicd" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FF9800;fillColor=#FFF3E0;" vertex="1" parent="1">
          <mxGeometry x="490" y="500" width="180" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="cicd-title" value="ðŸ”„ CI/CD PIPELINE" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="495" y="505" width="170" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="cicd-details" value="â€¢ Cloud Build automÃ¡tico&#10;â€¢ GitHub triggers&#10;â€¢ Deploy Cloud Run&#10;â€¢ Tests automÃ¡ticos&#10;â€¢ Docker registry" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=9;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="500" y="525" width="160" height="50" as="geometry"/>
        </mxCell>

        <!-- Servicios Externos -->
        <mxCell id="external-services" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#F44336;fillColor=#FFEBEE;" vertex="1" parent="1">
          <mxGeometry x="690" y="500" width="200" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="external-title" value="ðŸŒ SERVICIOS EXTERNOS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=11;fontStyle=1;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="695" y="505" width="190" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="external-details" value="â€¢ OpenAI API (GPT)&#10;â€¢ SMTP Gmail/SendGrid&#10;â€¢ Webpay/Transbank&#10;â€¢ VÃ­a Cloud NAT" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;fontSize=9;fontColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="700" y="525" width="180" height="50" as="geometry"/>
        </mxCell>

        <!-- Conexiones a servicios adicionales -->
        <mxCell id="cloudrun-secret" value="" style="endArrow=classic;html=1;strokeColor=#795548;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="secret-manager">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="380" as="sourcePoint"/>
            <mxPoint x="140" y="500" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="cloudrun-logging" value="" style="endArrow=classic;html=1;strokeColor=#607D8B;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cloudrun-backend" target="observability">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="150" y="380" as="sourcePoint"/>
            <mxPoint x="360" y="500" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="cicd-cloudrun" value="" style="endArrow=classic;html=1;strokeColor=#FF9800;strokeWidth=2;curved=0;dashed=1;" edge="1" parent="1" source="cicd" target="cloudrun-backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="500" as="sourcePoint"/>
            <mxPoint x="150" y="380" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="580" y="460"/>
              <mxPoint x="150" y="460"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="nat-external" value="" style="endArrow=classic;html=1;strokeColor=#F44336;strokeWidth=2;curved=0;" edge="1" parent="1" source="cloud-nat" target="external-services">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="550" y="330" as="sourcePoint"/>
            <mxPoint x="790" y="500" as="targetPoint"/>
            <Array as="points">
              <mxPoint x="550" y="470"/>
              <mxPoint x="790" y="470"/>
            </Array>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
